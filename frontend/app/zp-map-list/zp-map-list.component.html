<div class="row row-sm map-list-container">
  <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 padding-sm">
    <pnx-map
      height="91vh"
      [center]="storeService.sftConfig.zoom_center"
      [zoom]="storeService.sftConfig.zoom_level"
    >
      <pnx-geojson [onEachFeature]="onEachFeature.bind(this)" [geojson]="zps"> </pnx-geojson>
    </pnx-map>
  </div>

  <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 padding-sm tab-container list-sft">
    <sft-breadcrumbs></sft-breadcrumbs>

    <h3>Liste des sites</h3>

    <div class="row row-0">
      <div class="col padding-sm">
        <pnx-taxonomy
          #taxon
          label="{{ 'Taxon.Taxon' | translate }}"
          [parentFormControl]="taxonForm"
          [idList]="storeService.sftConfig.id_list_taxon"
          [charNumber]="3"
          [listLength]="20"
          (onChange)="onTaxonChanged($event)"
          (onDelete)="onDeleteParams('cd_nom', actualTaxonNameId); onDelete()"
        >
        </pnx-taxonomy>
      </div>

      <div class="col padding-sm">
        <small> Année de visite </small>
        <input
          type="number"
          [formControl]="filtreForm.controls.filtreYear"
          class="form-control form-control-sm"
          (onDeleteFiltre)="onDelete()"
        />
      </div>
    </div>

    <div id="bottom-search" class="row row-0 ">
      <div class="col padding-sm">
        <small> Organisme </small>
        <select
          class="form-control form-control-sm"
          name="monSelect"
          [formControl]="filtreForm.controls.filtreOrga"
        >
          <option [ngValue]="null"> Tous </option>
          <option *ngFor="let label of tabOrganism"> {{ label }} </option>
        </select>
      </div>

      <div class="col padding-sm">
        <small> Commune </small>
        <select
          class="form-control form-control-sm"
          name="monSelect"
          [formControl]="filtreForm.controls.filtreCom"
        >
          <option [ngValue]="null"> Toutes </option>
          <option *ngFor="let label of tabCom"> {{ label }} </option>
        </select>
      </div>
    </div>

    <ngx-datatable
      #dataTable
      class="material"
      [loadingIndicator]="loadingIndicator"
      [rows]="filteredData"
      [headerHeight]="50"
      [footerHeight]="50"
      [rowHeight]="50"
      [columnMode]="'force'"
      [selected]="mapListService.selectedRow"
      [selectionType]="'single'"
      (select)="mapListService.onRowSelect($event)"
      [rowClass]="mapListService.getRowClass"
      [count]="filteredData.length"
      [limit]="rowNumber"
      [messages]="storeService.sftConfig.zp_message"
    >
      <ngx-datatable-column
        *ngFor="let col of storeService.sftConfig.default_zp_columns"
        [name]="col.name"
        [prop]="col.prop"
        [maxWidth]="col.width"
      >
        <ng-template let-column="col" ngx-datatable-header-template>
          <span [title]="col.title">{{ col.name }}</span>
        </ng-template>
      </ngx-datatable-column>

      <ngx-datatable-column
        cellClass="actions-cell"
        maxWidth="90"
        name="Voir"
        title="Accéder aux visites du site"
      >
        <ng-template let-row="row" ngx-datatable-cell-template>
          <button
            type="button"
            class="btn btn-info btn-sm fa fa-eye"
            (click)="onInfo(row.id_base_site)"
            title="Visualiser"
          ></button>
        </ng-template>
      </ngx-datatable-column>
    </ngx-datatable>

    <div id="end-btn">
      <pnx-modal-download
        [pathDownload]="storeService.urlLoad"
        [exportFormat]="storeService.sftConfig.export_available_format"
        [queryString]="storeService.queryString"
        labelButton="Télécharger les visites"
      >
      </pnx-modal-download>
    </div>
  </div>
</div>
